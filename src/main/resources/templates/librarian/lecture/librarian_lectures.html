<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Librarian | Lectures</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" th:href="@{/assets/dist/css/bootstrap.min.css}">

    <!-- Custom styles for this template -->
    <link rel="stylesheet" th:href="@{/css/base.css}"/>
    <link rel="stylesheet" th:href="@{/css/fragment.css}"/>
    <link th:href="@{/css/styles/librarian.css}" rel="stylesheet">

</head>
<body class="app_container">

<header class="row" th:replace="~{fragments/header::headerLibrarianSection}"></header>
<div class="main_content">
    <div class="grid app__container-content-wrapper">
        <div class="app__container-content">
            <div class="lecture-details-head">
                <a th:href="@{/librarian}">Home</a>
                <span> &gt; Lectures management</span>
            </div>
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Lecturers</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                    </div>
                </div>
            </div>
            <div class="lib_data-list-wrapper">
                <div class="lib_search-container">
                    <form class="d-flex" th:action="@{/librarian/lectures/list/1}" th:method="get">
                        <div class="d-flex">
                            <div>
                                <input type="text" id="filter-search"
                                       class="form-control form-control-solid w-350px ps-14 mb-3"
                                       placeholder="Search lecture..."/>
                            </div>
                            <a class="lib_show-all-btn" th:href="@{/librarian/lectures/list/1}">Show All</a>
                        </div>
                    </form>
                    <div>
                        <a class="lib_btn-add" type="button" th:href="@{/librarian/lectures/create-lecture}">
                            <i class="fa-solid fa-plus"></i>
                            <span>Create Lecturer</span>
                        </a>
                    </div>
                </div>
            </div>
            <div class="table-view" th:if="${lecturers ne null}">
                <table class="table table-striped table-sm table-bordered" id="my_data_table">
                    <tr class="table-head">
                        <th>STT</th>
                        <th>Name</th>
                        <th>Email</th>
                        <!--                        <th>Status</th>-->
                        <th>Course List</th>

                    </tr>
                    <tbody>
                    <th:block th:each="lecture, iterStat : ${lecturers}" c>
                        <tr>
                            <td th:text="${iterStat.index+1}">1</td>
                            <td><a th:href="@{'/librarian/lectures/' + ${lecture.getId()}}"
                                   th:text="${lecture.getAccount().getName()}"></a></td>
                            <td><span class="description" th:text="${lecture.getAccount().getEmail()}"></span></td>
                            <!--                            <td th:text="${lecture.getDeleteFlg()}"></td>-->
                            <td>
                                <th:block th:each="course : ${lecture.getCourses()}">
                                    <a th:href="@{'/librarian/courses/' + ${course.getId()}}">
                                        <button class="button-a-background"
                                                th:text="${course.getCourseCode()}"></button>
                                    </a>
                                </th:block>
                            </td>

                        </tr>
                    </th:block>
                    </tbody>

                </table>

            </div>
        </div>
    </div>
</div>

<!-- Footer -->
<div class="row" th:replace="~{fragments/footer :: footerSection}"></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<!-- Bootstrap script -->
<script th:src="@{/assets/dist/js/bootstrap.bundle.min.js}"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
<!-- Custom script -->
<script th:src="@{/js/librarian/librarian.js}"></script>
</body>
<script>
    (function ($) {

        var paginate = {
            startPos: function (pageNumber, perPage) {
                return pageNumber * perPage;
            },

            getPage: function (items, startPos, perPage) {
                var page = [];
                items = items.slice(startPos, items.length);
                for (var i = 0; i < perPage; i++) {
                    page.push(items[i]);
                }

                return page;
            },

            totalPages: function (items, perPage) {
                return Math.ceil(items.length / perPage);
            },

            createBtns: function (totalPages, currentPage) {
                var pagination = $('<div class="pagination" />');

                pagination.append('<span class="pagination-button">&laquo;</span>');

                for (var i = 1; i <= totalPages; i++) {
                    if (totalPages > 5 && currentPage !== i) {
                        if (currentPage === 1 || currentPage === 2) {
                            if (i > 5) continue;
                        } else if (currentPage === totalPages || currentPage === totalPages - 1) {
                            // show last 5 pages
                            if (i < totalPages - 4) continue;
                        } else {
                            if (i < currentPage - 2 || i > currentPage + 2) {
                                continue;
                            }
                        }
                    }

                    var pageBtn = $('<span class="pagination-button page-num" />');
                    if (i == currentPage) {
                        pageBtn.addClass('active');
                    }
                    pageBtn.text(i);
                    pagination.append(pageBtn);
                }
                pagination.append($('<span class="pagination-button">&raquo;</span>'));
                return pagination;
            },
            createPage: function (items, currentPage, perPage) {

                $('.pagination').remove();

                // set context for the items
                var container = items.parent(),

                    items = items.detach().toArray(),

                    startPos = this.startPos(currentPage - 1, perPage),
                    page = this.getPage(items, startPos, perPage);

                $.each(page, function () {
                    if (this.window === undefined) {
                        container.append($(this));
                    }
                });

                var totalPages = this.totalPages(items, perPage),
                    pageButtons = this.createBtns(totalPages, currentPage);

                container.after(pageButtons);
            }
        };

        $.fn.paginate = function (perPage) {
            var items = $(this);

            if (isNaN(perPage) || perPage === undefined) {
                perPage = 5;
            }

            if (items.length <= perPage) {
                return true;
            }

            if (items.length !== items.parent()[0].children.length) {
                items.wrapAll('<div class="pagination-items" />');
            }

            paginate.createPage(items, 1, perPage);

            // handle click events on the buttons
            $(document).on('click', '.pagination-button', function (e) {
                var currentPage = parseInt($('.pagination-button.active').text(), 10),
                    newPage = currentPage,
                    totalPages = paginate.totalPages(items, perPage),
                    target = $(e.target);

                newPage = parseInt(target.text(), 10);
                if (target.text() == '«') newPage = 1;
                if (target.text() == '»') newPage = totalPages;

                if (newPage > 0 && newPage <= totalPages) {
                    paginate.createPage(items, newPage, perPage);
                }
            });
        };

    })(jQuery);

    document.getElementById("filter-search").addEventListener("input", function () {
        const filterValue = this.value.toLowerCase();
        const rows = document.querySelectorAll("#my_data_table tbody tr");

        rows.forEach(function (row) {
            const cells = row.querySelectorAll("td");
            let found = false;
            cells.forEach(function (cell) {
                if (cell.textContent.toLowerCase().includes(filterValue)) {
                    found = true;
                }
            });
            if (found) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
</script>
<style>
    .pagination {
        display: flex;
        width: 75%;
        margin: 1rem auto 5rem auto;
        text-align: center;

    &
    :after {
        content: '';
        clear: both;
    }

    }

    .pagination-button {
        display: inline-block;
        padding: 5px 10px;
        border: 1px solid #e0e0e0;
        background-color: #eee;
        color: #333;
        cursor: pointer;
        transition: background 0.1s, color 0.1s;

    &
    :hover {
        background-color: #ddd;
        color: #3366cc;
    }

    &
    .active {
        background-color: #bbb;
        border-color: #bbb;
        color: #3366cc;
    }

    $
    border-radius:

    18
    px

    ;

    &
    :first-of-type {
        border-radius: $ border-radius 0 0 $ border-radius;
    }

    &
    :last-of-type {
        border-radius: 0 $ border-radius $ border-radius 0;
    }

    }
</style>
</html>
